<div class="app-shell">
  <header class="top-bar">
    <div class="brand">
      <div class="logo-dot"></div>
      <div>
        <p class="system-name">{{ title }}</p>
        <span class="role-pill">Manager view</span>
      </div>
    </div>
    <div class="datetime">
      <div class="date">{{ formattedDate }}</div>
      <div class="time">{{ formattedTime }}</div>
    </div>
    <div class="user">
      <div class="avatar">M</div>
      <div>
        <p class="user-name">Manager</p>
        <span class="user-role">Full access</span>
      </div>
    </div>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <div class="nav-header">Main Navigation</div>
      <div class="nav-list">
        @for (item of navItems; track item) {
          <button class="nav-item" [class.active]="item === 'Dashboard'">
            <span class="bullet"></span>
            <span>{{ item }}</span>
          </button>
        }
      </div>
      <div class="sidebar-card">
        <p class="card-title">Today</p>
        <p class="card-subtitle">Keep operations in sync.</p>
        <ul>
          <li>Products ready for edits</li>
          <li>Purchases awaiting receipts</li>
          <li>Orders & ticket printing enabled</li>
          <li>Inventory view shared with team</li>
          <li>Reports & downloads available</li>
        </ul>
      </div>
    </aside>

    <main class="content">
      <section class="hero">
        <div>
          <p class="eyebrow">Manager workspace</p>
          <h1>Control inventory and sales from one console</h1>
          <p class="lead">
            Access product management, purchases, orders and ticket printing, inventory visibility, and reports without leaving this screen.
          </p>
          <div class="hero-actions">
            <button class="primary">View dashboard</button>
            <button class="ghost">Download reports</button>
          </div>
        </div>
        <div class="hero-panel">
          <p class="panel-title">Active features</p>
          <div class="panel-row">
            <span>Orders & ticket printing</span>
            <span class="pill success">Enabled</span>
          </div>
          <div class="panel-row">
            <span>Inventory view</span>
            <span class="pill success">Live</span>
          </div>
          <div class="panel-row">
            <span>Product management</span>
            <span class="pill">Editing</span>
          </div>
          <div class="panel-row">
            <span>Reports & downloads</span>
            <span class="pill">Ready</span>
          </div>
        </div>
      </section>

      <section class="stats-grid">
        @for (stat of stats; track stat.label) {
          <div class="stat-card">
            <p class="stat-label">{{ stat.label }}</p>
            <p class="stat-value">{{ stat.value }}</p>
            <p class="stat-hint">{{ stat.hint }}</p>
          </div>
        }
      </section>

      <section class="dashboard">
        <div class="section-header">
          <h2>Dashboard (Today)</h2>
          <p>Auto-refreshes when new orders or purchases arrive.</p>
        </div>
        <div class="metric-grid">
          @for (metric of dashboardMetrics; track metric.id) {
            <button class="metric-card" (click)="onMetricClick(metric.path)">
              <p class="metric-label">{{ metric.label }}</p>
              <div class="metric-value-row">
                <span class="metric-value">{{ metric.value | number }}</span>
                <span class="metric-unit">{{ metric.unit }}</span>
              </div>
              <span class="metric-link">View details â†’</span>
            </button>
          }
        </div>

        <div class="low-stock">
          <div class="section-header">
            <h3>Low-Stock Items Alert</h3>
            <p>Prioritize replenishment before end-of-day.</p>
          </div>
          <div class="alert-grid">
            @for (item of lowStockAlerts; track item.sku) {
              <div class="alert-card">
                <div>
                  <p class="alert-name">{{ item.name }}</p>
                  <p class="alert-sku">SKU: {{ item.sku }}</p>
                </div>
                <div class="alert-level">
                  <span class="level-dot"></span>
                  <span>{{ item.level }} {{ item.unit }}</span>
                </div>
              </div>
            }
          </div>
        </div>
      </section>

      <section class="products">
        <div class="section-header">
          <h2>Product management</h2>
          <p>Manage the master product list with validation and edit safeguards.</p>
        </div>

        <div class="product-layout">
          <div class="product-table-card">
            <div class="table-header">
              <h3>Product list</h3>
              <span class="table-hint">Click edit to update details (unit locked during edit).</span>
            </div>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>Product Name</th>
                    <th>Category</th>
                    <th>Unit</th>
                    <th>Buying Price</th>
                    <th>Selling Price</th>
                    <th>Current Stock</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  @for (product of products; track product.id) {
                    <tr>
                      <td>{{ product.name }}</td>
                      <td>{{ product.category }}</td>
                      <td>{{ product.unit }}</td>
                      <td>{{ product.buyingPrice | currency: 'USD':'symbol':'1.2-2' }}</td>
                      <td>{{ product.sellingPrice | currency: 'USD':'symbol':'1.2-2' }}</td>
                      <td>{{ product.stock | number }}</td>
                      <td>
                        <button class="link-btn" (click)="startEdit(product.id)">Edit</button>
                      </td>
                    </tr>
                  }
                  @if (products.length === 0) {
                    <tr>
                      <td colspan="7" class="empty-row">No products yet. Add a new product to get started.</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>

          <div class="product-form-card">
            <div class="form-header">
              <div>
                <h3>{{ editingProductId ? 'Edit product' : 'Add product' }}</h3>
                <p class="form-hint">
                  Product name must be unique. Unit is disabled while editing. Stock is read-only after creation.
                </p>
              </div>
              @if (editingProductId) {
                <button class="ghost small" type="button" (click)="resetForm()">Cancel edit</button>
              }
            </div>

            <form (ngSubmit)="submitProduct()" #productFormRef="ngForm" class="product-form">
              <label>
                <span>Product Name</span>
                <input
                  name="name"
                  [(ngModel)]="productForm.name"
                  type="text"
                  placeholder="e.g., Barcode Labels 4x6"
                  required
                />
                @if (formErrors['name']) {
                  <span class="error">{{ formErrors['name'] }}</span>
                }
              </label>

              <label>
                <span>Category</span>
                <select name="category" [(ngModel)]="productForm.category" required>
                  <option value="" disabled>Select category</option>
                  @for (cat of productCategories; track cat) {
                    <option [value]="cat">{{ cat }}</option>
                  }
                </select>
                @if (formErrors['category']) {
                  <span class="error">{{ formErrors['category'] }}</span>
                }
              </label>

              <label>
                <span>Unit</span>
                <select
                  name="unit"
                  [(ngModel)]="productForm.unit"
                  [disabled]="editingProductId !== null"
                  required
                >
                  <option value="" disabled>Select unit</option>
                  @for (unit of productUnits; track unit) {
                    <option [value]="unit">{{ unit }}</option>
                  }
                </select>
                @if (editingProductId !== null) {
                  <span class="field-note">Unit cannot be changed during edit.</span>
                }
                @if (formErrors['unit']) {
                  <span class="error">{{ formErrors['unit'] }}</span>
                }
              </label>

              <div class="form-grid">
                <label>
                  <span>Buying Price</span>
                  <input
                    name="buyingPrice"
                    [(ngModel)]="productForm.buyingPrice"
                    type="number"
                    step="0.01"
                    min="0"
                    required
                  />
                  @if (formErrors['buyingPrice']) {
                    <span class="error">{{ formErrors['buyingPrice'] }}</span>
                  }
                </label>
                <label>
                  <span>Selling Price</span>
                  <input
                    name="sellingPrice"
                    [(ngModel)]="productForm.sellingPrice"
                    type="number"
                    step="0.01"
                    min="0"
                    required
                  />
                  @if (formErrors['sellingPrice']) {
                    <span class="error">{{ formErrors['sellingPrice'] }}</span>
                  }
                </label>
              </div>

              @if (editingProductId === null) {
                <label>
                  <span>Initial Stock</span>
                  <input
                    name="initialStock"
                    [(ngModel)]="productForm.initialStock"
                    type="number"
                    min="0"
                    required
                  />
                  @if (formErrors['initialStock']) {
                    <span class="error">{{ formErrors['initialStock'] }}</span>
                  }
                </label>
              } @else {
                <label>
                  <span>Current Stock (read-only after creation)</span>
                  <input type="number" [value]="editingProduct?.stock" readonly />
                </label>
              }

              <div class="form-actions">
                <button class="primary" type="submit">
                  {{ editingProductId ? 'Save changes' : 'Add product' }}
                </button>
                <button class="ghost" type="button" (click)="resetForm()">Clear</button>
              </div>
            </form>
          </div>
        </div>
      </section>

      <section class="features">
        <div class="section-header">
          <h2>Accessible features</h2>
          <p>All tools available to the Manager profile.</p>
        </div>
        <div class="feature-grid">
          @for (feature of featureTiles; track feature.title) {
            <div class="feature-card">
              <div class="feature-icon"></div>
              <div>
                <p class="feature-title">{{ feature.title }}</p>
                <p class="feature-desc">{{ feature.description }}</p>
              </div>
            </div>
          }
        </div>
      </section>
    </main>
  </div>
</div>

