<section class="orders no-print">
  <h2>Create Order</h2>

  <label>
    Waiter name *
    <input type="text" [(ngModel)]="waiterName" />
  </label>

  <button type="button" class="add-item" (click)="addRow()">
    + Add item
  </button>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Source</th>
          <th>Product</th>
          <th>Stock</th>
          <th>Qty</th>
          <th>Unit</th>
          <th>Price</th>
          <th>Total</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of items">
          <td>
            <select [(ngModel)]="item.source" (change)="onSourceChange(item)">
              <option value="STOCK">From stock</option>
              <option value="KITCHEN">From kitchen</option>
            </select>
          </td>

          <td>
            <select
              *ngIf="item.source === 'STOCK'"
              [(ngModel)]="item.productName"
              (change)="onStockProductChange(item)"
            >
              <option value="">Select</option>
              <option *ngFor="let s of stockItems" [value]="s.productName">
                {{ s.productName }}
              </option>
            </select>

            <input
              *ngIf="item.source === 'KITCHEN'"
              type="text"
              placeholder="Food name"
              [(ngModel)]="item.productName"
            />
          </td>

          <td class="numeric">
            {{ item.source === 'STOCK' ? item.availableStock : '—' }}
          </td>

          <td>
            <input type="number" min="1" [(ngModel)]="item.quantity" />
          </td>

          <td>{{ item.unit || '—' }}</td>

          <td>
            <input type="number" min="0" [(ngModel)]="item.unitPrice" />
          </td>

          <td class="numeric">
            {{ itemTotal(item) | currency:'ETB' }}
          </td>

          <td>
            <button (click)="removeRow(item.id)">✕</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="summary">
    <strong>Total:</strong>
    {{ total | currency:'ETB' }}
  </div>

  <p class="error" *ngIf="error">{{ error }}</p>

  <button class="primary" (click)="submitOrder()" [disabled]="loading">
    Create order
  </button>

  <!-- PRINT CONFIRMATION -->
  <div class="modal-backdrop" *ngIf="showPrintModal">
    <div class="modal">
      <h3>Print Order Ticket?</h3>

      <!-- PREVIEW INSIDE POPUP -->
      <div id="receipt">
        <div class="center">
          <h3>Zemera Cafe</h3>
          <p>Order #{{ ticket.orderId }}</p>
        </div>

        <hr />

        <p>Date: {{ ticket.createdAt | date:'short' }}</p>
        <p>Waiter: {{ ticket.waiterName }}</p>

        <hr />

        <table class="receipt-table">
          <tr *ngFor="let item of ticket.items">
            <td class="left">{{ item.productName }}</td>
            <td class="center">{{ item.quantity }} x {{ item.unitPrice }}</td>
            <td class="right">{{ item.lineTotal }}</td>
          </tr>
        </table>

        <hr />

        <p class="total">TOTAL: {{ ticket.totalAmount | currency:'ETB' }}</p>
        <p class="center">Thank you!</p>
      </div>

      <div class="modal-buttons">
  <button class="primary" (click)="confirmPrint()">Print</button>
  <button class="ghost" (click)="cancelPrint()">Cancel</button>
</div>
    </div>
  </div>
</section>
