<section class="orders">
  <h2>Create Order</h2>

  <label>
    Waiter name *
    <input type="text" [(ngModel)]="waiterName" />
  </label>

  <table>
    <thead>
      <tr>
        <th>Source</th>
        <th>Product</th>
        <th>Stock</th>
        <th>Qty</th>
        <th>Unit</th>
        <th>Price</th>
        <th>Total</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let item of items">
        <td>
          <select [(ngModel)]="item.source" (change)="onSourceChange(item)">
            <option value="STOCK">From stock</option>
            <option value="KITCHEN">From kitchen</option>
          </select>
        </td>

        <td>
          <select
            *ngIf="item.source === 'STOCK'"
            [(ngModel)]="item.productName"
            (change)="onStockProductChange(item)"
          >
            <option value="">Select</option>
            <option *ngFor="let s of stockItems" [value]="s.productName">
              {{ s.productName }}
            </option>
          </select>

          <input
            *ngIf="item.source === 'KITCHEN'"
            type="text"
            placeholder="Food name"
            [(ngModel)]="item.productName"
          />
        </td>

        <td class="numeric">
          {{ item.source === 'STOCK' ? item.availableStock : '—' }}
        </td>

        <td>
          <input type="number" min="1" [(ngModel)]="item.quantity" />
        </td>

        <td>{{ item.unit || '—' }}</td>

        <td>
          <input
            type="number"
            min="0"
            [(ngModel)]="item.unitPrice"
          />
        </td>

        <td class="numeric">
          {{ itemTotal(item) | currency:'ETB' }}
        </td>

        <td>
          <button (click)="removeRow(item.id)">✕</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="summary">
    <strong>Total:</strong>
    {{ total | currency:'ETB' }}
  </div>

  <p class="error" *ngIf="error">{{ error }}</p>

  <button class="primary" (click)="submitOrder()" [disabled]="loading">
    Create order
  </button>

  <!-- PRINT CONFIRMATION MODAL -->
<div class="modal-backdrop" *ngIf="ticket">
  <div class="modal">
    <h3>Print Order Ticket?</h3>

    <div class="ticket-preview">
      <h4>Order #{{ ticket.orderId }}</h4>
      <p>Date: {{ ticket.createdAt | date:'short' }}</p>
      <p>Waiter: {{ ticket.waiterName }}</p>

      <hr />

      <div *ngFor="let i of ticket.items">
        {{ i.quantity }} {{ i.unit }} {{ i.productName }}
        <span class="right">
          {{ i.lineTotal | currency:'ETB' }}
        </span>
      </div>

      <hr />
      <strong>Total: {{ ticket.totalAmount | currency:'ETB' }}</strong>
    </div>

    <div class="actions">
      <button class="ghost" (click)="cancelPrint()">Cancel</button>
      <button class="primary" (click)="confirmPrint()">Print</button>
    </div>
  </div>
</div>


  <!-- Ticket -->
  <div *ngIf="ticket" class="ticket">
    <h3>Order #{{ ticket.orderId }}</h3>
    <p>Waiter: {{ ticket.waiterName }}</p>

    <div *ngFor="let i of ticket.items">
      {{ i.quantity }} {{ i.unit }} {{ i.productName }} –
      {{ i.lineTotal | currency:'ETB' }}
    </div>

    <strong>Total: {{ ticket.totalAmount | currency:'ETB' }}</strong>

    <button (click)="printTicket()">Print</button>
  </div>
</section>
