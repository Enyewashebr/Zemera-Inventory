<section class="reports">
  <div class="section-header">
    <h2>Reports</h2>
    <p>Select report type and time period, then download PDF or Excel.</p>
  <label *ngIf="isSuperManager">
  Select Branch
  <select [(ngModel)]="selectedBranchId" (change)="loadReport()">
    <option [ngValue]="null">-- Select Branch --</option>
    <option *ngFor="let b of branches" [ngValue]="b.id">
      {{ b.name }}
    </option>
  </select>
</label>

  </div>

  <div class="filters">
    <label>
      Time
      <select [(ngModel)]="selectedTime">
        <option value="daily">Daily</option>
        <option value="monthly">Monthly</option>
        <option value="yearly">Yearly</option>
      </select>
    </label>

    <label>
      Report
      <select [(ngModel)]="selectedReport">
        <option value="sales">Sales</option>
        <option value="purchases">Purchases</option>
        <option value="profit">Profit</option>
      </select>
    </label>

    <!-- Date / Month / Year input -->
    <label *ngIf="selectedTime === 'daily'">
      Date
      <input type="date" [(ngModel)]="filterDate" />
    </label>
    <label *ngIf="selectedTime === 'monthly'">
      Month
      <input type="month" [(ngModel)]="filterMonth" />
    </label>
    <label *ngIf="selectedTime === 'yearly'">
      Year
      <input type="number" [(ngModel)]="filterYear" min="2000" max="2100" />
    </label>
  </div>

  <div class="table-wrapper" *ngIf="selectedReport === 'sales'">
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Quantity</th>
          <th>Unit</th>
          <th>Unit Price</th>
          <th>Total</th>
          <th>Waiter</th>
          <th>Sold At</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of salesRows">
          <td>{{ row.item }}</td>
          <td>{{ row.qty }}</td>
          <td>{{ row.unit }}</td>
          <td>{{ row.unitPrice | currency:'ETB':'symbol':'1.2-2' }}</td>
          <td>{{ row.totalPrice | currency:'ETB':'symbol':'1.2-2' }}</td>
          <td>{{ row.waiter }}</td>
          <td>{{ row.timestamp | date:'short' }}</td>
        </tr>
      </tbody>
    </table>
    <div class="summary">Total Sales: {{ totalSales | currency:'ETB':'symbol':'1.2-2' }}</div>
  </div>

  <div class="table-wrapper" *ngIf="selectedReport === 'purchases'">
    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>Quantity</th>
          <th>Unit</th>
          <th>Unit Price</th>
          <th>Total Cost</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of purchaseRows">
          <td>{{ row.item }}</td>
          <td>{{ row.qty }}</td>
          <td>{{ row.unit }}</td>
          <td>{{ row.unitPrice | currency:'ETB':'symbol':'1.2-2' }}</td>
          <td>{{ row.qty * row.unitPrice | currency:'ETB':'symbol':'1.2-2' }}</td>
        </tr>
      </tbody>
    </table>
    <div class="summary">Total Purchases: {{ totalPurchases | currency:'ETB':'symbol':'1.2-2' }}</div>
  </div>

  <div class="profit-card" *ngIf="selectedReport === 'profit'">
    <div class="profit-grid">
      <div class="metric">
        <span>Total Sales</span>
        <span>{{ totalSales | currency:'ETB':'symbol':'1.2-2' }}</span>
      </div>
      <div class="metric">
        <span>Total Purchases</span>
        <span>{{ totalPurchases | currency:'ETB':'symbol':'1.2-2' }}</span>
      </div>
      <div class="metric">
        <span>Profit</span>
        <span>{{ profit | currency:'ETB':'symbol':'1.2-2' }}</span>
      </div>
    </div>
  </div>
  <div class="download-bar">
    <button (click)="download('pdf')">Download PDF</button>
    <button (click)="download('xls')">Download Excel</button>
  </div>
</section>
