<section class="purchases">
  <div class="section-header">
    <h2>Purchase Management</h2>
    <p>Record incoming stock and track approval status.</p>
  </div>

  <div class="layout">
    <div class="form-card">
      <h3>Add Purchase</h3>
      <form (ngSubmit)="savePurchase()" class="purchase-form">
        <label>
          <span>Product *</span>
          <select name="productId" [(ngModel)]="form.productId" (change)="onProductChange()" required>
            <option value="" disabled>Select product</option>
            <option *ngFor="let p of products" [value]="p.id">{{ p.name }} ({{ p.unit }})</option>
          </select>
          <span class="error" *ngIf="formErrors.productId">{{ formErrors.productId }}</span>
        </label>

        <label>
          <span>Quantity *</span>
          <input type="number" name="quantity" min="1" [(ngModel)]="form.quantity" (input)="calculateTotal()" required>
          <span class="error" *ngIf="formErrors.quantity">{{ formErrors.quantity }}</span>
        </label>

        <label>
          <span>Unit Price *</span>
          <input type="number" name="unitPrice" min="0" step="0.01" [(ngModel)]="form.unitPrice" (input)="calculateTotal()" required>
          <span class="error" *ngIf="formErrors.unitPrice">{{ formErrors.unitPrice }}</span>
        </label>

        <label>
          <span>Purchase Date *</span>
          <input type="date" name="date" [(ngModel)]="form.date" required>
          <span class="error" *ngIf="formErrors.date">{{ formErrors.date }}</span>
        </label>

        <div>
          <span>Total Cost: {{ totalCost | currency:'ETB':'symbol':'1.2-2' }}</span>
        </div>

        <div class="actions">
          <button class="primary" type="submit" [disabled]="isSaving">Save Purchase</button>
          <button type="button" class="ghost" (click)="clearForm()">Clear Form</button>
        </div>

        <div class="success" *ngIf="successMessage">{{ successMessage }}</div>
      </form>
    </div>

    <div class="history-card">
      <h3>Purchase History</h3>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Product</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total Cost</th>
            <th>Status</th>
            <th>Approved By</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of purchases">
            <td>{{ row.date }}</td>
            <td>{{ row.productName }}</td>
            <td>{{ row.quantity }}</td>
            <td>{{ row.unitPrice | currency:'ETB':'symbol':'1.2-2' }}</td>
            <td>{{ row.totalCost | currency:'ETB':'symbol':'1.2-2' }}</td>
            <td>{{ row.status }}</td>
            <td>{{ row.approvedBy || 'â€”' }}</td>
          </tr>
          <tr *ngIf="purchases.length === 0">
            <td colspan="7" class="empty-row">No purchases recorded yet.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
